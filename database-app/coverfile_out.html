
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>service: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/cfabrica46/gokit-crud/database-app/service/endpoints.go (100.0%)</option>
				
				<option value="file1">github.com/cfabrica46/gokit-crud/database-app/service/service.go (100.0%)</option>
				
				<option value="file2">github.com/cfabrica46/gokit-crud/database-app/service/transport.go (100.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package service

import (
        "context"

        "github.com/go-kit/kit/endpoint"
)

// MakeGetAllUsersEndpoint ...
func MakeGetAllUsersEndpoint(svc serviceInterface) endpoint.Endpoint <span class="cov8" title="1">{
        return func(_ context.Context, _ interface{}) (interface{}, error) </span><span class="cov8" title="1">{
                users, err := svc.GetAllUsers()
                if err != nil </span><span class="cov8" title="1">{
                        return GetAllUsersResponse{users, err.Error()}, nil
                }</span>

                <span class="cov8" title="1">return GetAllUsersResponse{users, ""}, nil</span>
        }
}

// MakeGetUserByIDEndpoint ...
func MakeGetUserByIDEndpoint(svc serviceInterface) endpoint.Endpoint <span class="cov8" title="1">{
        return func(_ context.Context, request interface{}) (interface{}, error) </span><span class="cov8" title="1">{
                req, _ := request.(GetUserByIDRequest)
                user, err := svc.GetUserByID(req.ID)
                if err != nil </span><span class="cov8" title="1">{
                        return GetUserByIDResponse{user, err.Error()}, nil
                }</span>

                <span class="cov8" title="1">return GetUserByIDResponse{user, ""}, nil</span>
        }
}

// MakeGetUserByUsernameAndPasswordEndpoint ...
func MakeGetUserByUsernameAndPasswordEndpoint(svc serviceInterface) endpoint.Endpoint <span class="cov8" title="1">{
        return func(_ context.Context, request interface{}) (interface{}, error) </span><span class="cov8" title="1">{
                req, _ := request.(GetUserByUsernameAndPasswordRequest)
                user, err := svc.GetUserByUsernameAndPassword(req.Username, req.Password)
                if err != nil </span><span class="cov8" title="1">{
                        return GetUserByUsernameAndPasswordResponse{user, err.Error()}, nil
                }</span>

                <span class="cov8" title="1">return GetUserByUsernameAndPasswordResponse{user, ""}, nil</span>
        }
}

// MakeGetIDByUsernameEndpoint ...
func MakeGetIDByUsernameEndpoint(svc serviceInterface) endpoint.Endpoint <span class="cov8" title="1">{
        return func(_ context.Context, request interface{}) (interface{}, error) </span><span class="cov8" title="1">{
                req, _ := request.(GetIDByUsernameRequest)
                id, err := svc.GetIDByUsername(req.Username)
                if err != nil </span><span class="cov8" title="1">{
                        return GetIDByUsernameResponse{id, err.Error()}, nil
                }</span>

                <span class="cov8" title="1">return GetIDByUsernameResponse{id, ""}, nil</span>
        }
}

// MakeInsertUserEndpoint ...
func MakeInsertUserEndpoint(svc serviceInterface) endpoint.Endpoint <span class="cov8" title="1">{
        return func(_ context.Context, request interface{}) (interface{}, error) </span><span class="cov8" title="1">{
                req, _ := request.(InsertUserRequest)
                err := svc.InsertUser(req.Username, req.Password, req.Email)
                if err != nil </span><span class="cov8" title="1">{
                        return InsertUserResponse{err.Error()}, nil
                }</span>

                <span class="cov8" title="1">return InsertUserResponse{""}, nil</span>
        }
}

// MakeDeleteUserEndpoint ...
func MakeDeleteUserEndpoint(svc serviceInterface) endpoint.Endpoint <span class="cov8" title="1">{
        return func(_ context.Context, request interface{}) (interface{}, error) </span><span class="cov8" title="1">{
                req, _ := request.(DeleteUserRequest)
                rowsAffected, err := svc.DeleteUser(req.ID)
                if err != nil </span><span class="cov8" title="1">{
                        return DeleteUserResponse{rowsAffected, err.Error()}, nil
                }</span>

                <span class="cov8" title="1">return DeleteUserResponse{rowsAffected, ""}, nil</span>
        }
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package service

import (
        "database/sql"
        "log"
)

type serviceInterface interface {
        GetAllUsers() ([]User, error)
        GetUserByID(int) (User, error)
        GetUserByUsernameAndPassword(string, string) (User, error)
        GetIDByUsername(string) (int, error)
        InsertUser(string, string, string) error
        DeleteUser(int) (int, error)
}

// Service ...
type Service struct {
        db *sql.DB

        // Data for DB
        host, port, user, password, dbName, sslmode, driver string
}

// GetService ...
func GetService(db *sql.DB) *Service <span class="cov8" title="1">{
        return &amp;Service{db: db}
}</span>

// GetAllUsers ...
func (s Service) GetAllUsers() (users []User, err error) <span class="cov8" title="1">{
        log.SetFlags(log.Lshortfile)
        rows, err := s.db.Query("SELECT id, username, email FROM users")
        if err != nil </span><span class="cov8" title="1">{
                return
        }</span>

        <span class="cov8" title="1">for rows.Next() </span><span class="cov8" title="1">{
                var userBeta User
                rows.Scan(&amp;userBeta.ID, &amp;userBeta.Username, &amp;userBeta.Email)
                users = append(users, userBeta)
        }</span>
        <span class="cov8" title="1">return</span>
}

// GetUserByID ...
func (s Service) GetUserByID(id int) (user User, err error) <span class="cov8" title="1">{
        row := s.db.QueryRow("SELECT id, username, password, email FROM users WHERE id = $1", id)

        err = row.Scan(&amp;user.ID, &amp;user.Username, &amp;user.Password, &amp;user.Email)
        if err != nil </span><span class="cov8" title="1">{
                if err == sql.ErrNoRows </span><span class="cov8" title="1">{
                        err = nil
                }</span>
                <span class="cov8" title="1">return</span>
        }
        <span class="cov8" title="1">return</span>
}

// GetUserByUsernameAndPassword ...
func (s Service) GetUserByUsernameAndPassword(username, password string) (user User, err error) <span class="cov8" title="1">{
        row := s.db.QueryRow(
                "SELECT id, username, password, email FROM users WHERE username = $1 AND password = $2",
                username,
                password,
        )

        err = row.Scan(&amp;user.ID, &amp;user.Username, &amp;user.Password, &amp;user.Email)
        if err != nil </span><span class="cov8" title="1">{
                if err == sql.ErrNoRows </span><span class="cov8" title="1">{
                        err = nil
                }</span>
                <span class="cov8" title="1">return</span>
        }
        <span class="cov8" title="1">return</span>
}

// GetIDByUsername ...
func (s Service) GetIDByUsername(username string) (id int, err error) <span class="cov8" title="1">{
        row := s.db.QueryRow("SELECT id FROM users WHERE username = $1", username)

        err = row.Scan(&amp;id)
        if err != nil </span><span class="cov8" title="1">{
                if err == sql.ErrNoRows </span><span class="cov8" title="1">{
                        err = nil
                }</span>
                <span class="cov8" title="1">return</span>
        }
        <span class="cov8" title="1">return</span>
}

// InsertUser ...
func (s *Service) InsertUser(username, password, email string) (err error) <span class="cov8" title="1">{
        _, err = s.db.Exec(
                "INSERT INTO users(username, password, email) VALUES ($1,$2,$3)",
                username,
                password,
                email,
        )
        if err != nil </span><span class="cov8" title="1">{
                return
        }</span>

        <span class="cov8" title="1">return</span>
}

// DeleteUser ...
func (s *Service) DeleteUser(id int) (rowsAffected int, err error) <span class="cov8" title="1">{
        r, err := s.db.Exec("DELETE FROM users WHERE id = $1", id)
        if err != nil </span><span class="cov8" title="1">{
                return
        }</span>

        <span class="cov8" title="1">count, _ := r.RowsAffected()
        rowsAffected = int(count)
        return</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package service

import (
        "context"
        "encoding/json"
        "net/http"
)

// DecodeGetAllUsersRequest ...
func DecodeGetAllUsersRequest(_ context.Context, _ *http.Request) (interface{}, error) <span class="cov8" title="1">{
        var request GetAllUsersRequest
        return request, nil
}</span>

// DecodeGetUserByIDRequest ...
func DecodeGetUserByIDRequest(_ context.Context, r *http.Request) (interface{}, error) <span class="cov8" title="1">{
        var request GetUserByIDRequest
        if err := json.NewDecoder(r.Body).Decode(&amp;request); err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return request, nil</span>
}

// DecodeGetUserByUsernameAndPasswordRequest ...
func DecodeGetUserByUsernameAndPasswordRequest(_ context.Context, r *http.Request) (interface{}, error) <span class="cov8" title="1">{
        var request GetUserByUsernameAndPasswordRequest
        if err := json.NewDecoder(r.Body).Decode(&amp;request); err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return request, nil</span>
}

// DecodeGetIDByUsernameRequest ...
func DecodeGetIDByUsernameRequest(_ context.Context, r *http.Request) (interface{}, error) <span class="cov8" title="1">{
        var request GetIDByUsernameRequest
        if err := json.NewDecoder(r.Body).Decode(&amp;request); err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return request, nil</span>
}

// DecodeInsertUserRequest ...
func DecodeInsertUserRequest(_ context.Context, r *http.Request) (interface{}, error) <span class="cov8" title="1">{
        var request InsertUserRequest
        if err := json.NewDecoder(r.Body).Decode(&amp;request); err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return request, nil</span>
}

// DecodeDeleteUserRequest ...
func DecodeDeleteUserRequest(_ context.Context, r *http.Request) (interface{}, error) <span class="cov8" title="1">{
        var request DeleteUserRequest
        if err := json.NewDecoder(r.Body).Decode(&amp;request); err != nil </span><span class="cov8" title="1">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return request, nil</span>
}

// EncodeResponse ...
func EncodeResponse(_ context.Context, w http.ResponseWriter, response interface{}) error <span class="cov8" title="1">{
        return json.NewEncoder(w).Encode(response)
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
